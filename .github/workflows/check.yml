name: Check API YAML Modification on Pull Request

on:
  pull_request:
    branches: [ main ]
    types: [ opened, synchronize ]

jobs:
  check-api-modification:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
      with:
        ref: ${{ github.head_ref }}
    - name: Get previous commit hash
      run: |
        PREV_COMMIT=$(git log --pretty=format:'%h' -n 1 HEAD~1)
        echo "Previous commit hash: $PREV_COMMIT"
    - name: Check if API YAML was modified
      run: |
        git diff --name-only $PREV_COMMIT..HEAD | grep "_build/api.yaml"
        if [ $? -eq 0 ]; then
          echo "API YAML was modified"
        else
          echo "API YAML was not modified"
          exit 1
        fi
